# 移动端程序需求和设计报告

---

## 前言

我们之前已经开发过在PC端的demo，但是缺乏对于移动端的程序开发的相关经验。最近做了一些技术调查，结合一些语言模型的相关建议，总结了我们的需求和可供采用的技术。

总体而言，PWA（移动端网页程序）比较适合快速开发和上线的需求，且不需要经过微信平台审核，可能是比较理想的形式。

**下一步计划：**

- 配置PWA的相关开发环境
- 网站SSL证书过期了，开发PWA需要这个，重新申一个
- 先直接上线程序demo，只实现框架最基础的功能

---

## 一、需求分析

### 1. 蓝牙通讯功能
- 支持BLE蓝牙设备扫描、连接与断开。
- 与MSP430工作站进行数据通讯：实现命令发送和数据接收。
    - 启动/停止实验
    - 切换实验模式
    - 实验参数设置
    - 实时数据接收
- 设备状态实时反馈，支持断线自动重连和异常告警。

### 2. 实验数据采集与管理
- 实时接收CV、LSV等多种电化学实验数据。
- 支持数据存储（本地or云端）。
- 实验历史数据管理：按时间、实验类型、标签分类检索。

### 3. 数据可视化
- 实时曲线绘制，支持多轮实验数据比对。
- 图表交互：缩放、拖动、数据点悬浮提示，区间选取分析。

### 4. 基础分析计算
- 峰值电流、电位、背景扣除等常见分析算法。
- 分析结果可视化与导出。

### 5. 用户界面与交互
- 首页：设备连接、状态显示、实验快捷入口。
- 数据管理：实验记录列表、详情查看、分析历史。
- 设置页：参数配置。

---

## 二、实现方式选择

| 形态                              | 上手速度  | BLE 能力                   | 图表/分析                              | 分发/部署           | 备注                                |
| ------------------------------- | ----- | ------------------------ | ---------------------------------- | --------------- | --------------------------------- |
| **PWA (Web)**                   | ★★★★☆ | Android OK，iOS 16.4+ 才稳定 | 直接用 ECharts/D3，Python 算法可 wasm 或后端 | 一个 HTTPS 链接即可   | 不需上架，扫码即用；iOS 旧系统需提示用户用 Safari 打开 |
| **微信小程序**                       | ★★★★☆ | 基础库 2.20+ 支持 BLE，真机调试快   | 微信 canvas 2d + 自建云函数（Python 跑算法）   | 微信生态内分享         | 代码包 2 MB，适合轻量；需要企业认证才能用部分 BLE API |
| **uni-app / Taro 写一次多端 App**    | ★★★☆☆ | 依赖原生 BLE 插件，社区有现成封装      | uCharts、ECharts 小程序版               | 可编译成微信小程序 + App | 如果你们后期想要真正的 App，这是最平滑的迁移路径        |
| **纯 App (Flutter + Python 后端)** | ★★☆☆☆ | 官方蓝牙库稳定                  | 前端用 fl\_chart，分析放后端 FastAPI        | 需打包 iOS/Android | 成本最高，但体验最好，适合长期维护                 |

考虑先尝试PWA（移动端Web）形式实现，挂到我们的云服务器中，主要优点：
1. 不需要平台审核和企业认证
2. 开发代码量相对较小
3. 上线快

---

## 三、技术链选择

### 1. 前端（PWA部分）

- **核心框架：**
  - Vue.js（建议，适合SPA和PWA，且有经验）
- **PWA相关：**
  - Workbox（简化Service Worker开发）
  - manifest.json（PWA配置）
- **蓝牙通信：**
  - Web Bluetooth API（原生JS即可，Vue中调用）
- **数据可视化：**
  - ECharts 或 Chart.js（推荐ECharts，功能强大，适合科学数据）
- **本地数据存储：**
  - IndexedDB（推荐Dexie.js进行操作）
- **UI库（可选）：**
  - Vuetify 或 Element Plus（Vue生态主流UI组件）

### 2. 后端（Django/MySQL）

- **Web框架：**
  - Django（有经验，且非常适合RESTful API开发）
  - Django REST Framework（强烈推荐，RESTful接口开发非常高效）
- **数据库：**
  - MySQL（我们有资源，也与Django兼容良好）
- **API设计：**
  - RESTful API（前端通过fetch/AJAX/axios与后端交互）
- **数据分析（如需在后端实现复杂计算）：**
  - Python科学库（如numpy、scipy、pandas，Django后台可以调用）
- **静态文件管理：**
  - Django的静态文件管理或Apache直接托管前端静态资源

### 3. 部署与运维

- **Web服务器：**
  - Apache2（已配置，推荐用mod_wsgi部署Django项目）
- **HTTPS证书：**
  - Let’s Encrypt（免费，自动化，适合校园/学生服务器）
- **云服务器：**
  - 我们的学生云服务器（部署前后端，数据库）
- **版本管理：**
  - Git + GitHub
- **CI/CD（可选）：**
  - GitHub Actions 或其他自动化工具

---

## 二、系统总体架构（更新版）

### 1. 前端架构（PWA）

```
┌──────────────────────────────────────────────┐
│                PWA前端(Vue.js)               │
│ ┌─────────┬─────────────┬───────────────┐    │
│ │ 蓝牙模块 │  数据可视化  │ 本地存储      │    │
│ └─────────┴─────────────┴───────────────┘    │
│              ↕   (REST API)                  │
└──────────────────────────────────────────────┘
            ↑
            │ 蓝牙（Web Bluetooth API）
            ↓
┌──────────────────────────────────────────────┐
│   微型电化学工作站（MSP430+BLE模块）           │
└──────────────────────────────────────────────┘
```

### 2. 后端架构（Django+MySQL）

```
┌─────────────┐
│  PWA前端    │
└─────▲───────┘
      │  HTTP/HTTPS（REST API）
┌─────┴───────┐
│  后端API    │  ——  数据库
│（Django+DRF）│      （MySQL）
└─────────────┘
      │
┌─────┴───────┐
│ Apache2服务器│
└─────────────┘
```

---

## 三、开发建议与技术选型说明

- **前端PWA建议用Vue.js + ECharts**，蓝牙通讯用Web Bluetooth API，数据本地缓存用IndexedDB（Dexie.js）。
- **后端建议用Django + Django REST Framework实现RESTful接口**，负责账号管理、数据云同步、分析计算等。
- **数据库用MySQL**，存储用户、数据等。
- **前端静态文件（dist打包后）可以直接由Apache2托管，也可以通过Django的静态文件系统管理。**
- **API通过HTTPS暴露，保证安全。**
- **如果只做本地数据采集与可视化，前端即可。若涉及云同步、用户管理，则需开发后端。**
- **Django适合此项目，生态强大，学习成本低，且你已有经验。**

---

## 四、项目结构建议

### 1. 前端项目结构（Vue.js）

```text
frontend/
  ├── public/
  ├── src/
      ├── components/
      ├── views/
      ├── assets/
      ├── bluetooth/   # 蓝牙操作模块
      ├── charts/      # 数据可视化模块
      ├── storage/     # 本地存储相关
      ├── App.vue
      └── main.js
  ├── manifest.json
  ├── service-worker.js
  └── package.json
```

### 2. 后端项目结构（Django）

```text
backend/
  ├── manage.py
  ├── project_name/
      ├── settings.py
      ├── urls.py
      ├── wsgi.py
  ├── api/
      ├── models.py
      ├── views.py
      ├── serializers.py
      ├── urls.py
  ├── static/
  └── templates/
```

---

## 五、部署流程简述

1. **前端打包发布（Vue.js build后）到Apache2静态目录或Django static目录。**
2. **后端Django项目通过mod_wsgi部署到Apache2，API通过HTTPS暴露。**
3. **数据库MySQL配置好，Django连接并存储数据。**
4. **HTTPS证书部署，保证Web Bluetooth和用户数据安全。**

---

## 六、参考资源

- [Django官方文档](https://docs.djangoproject.com/zh-hans/4.2/)
- [Django REST Framework](https://www.django-rest-framework.org/)
- [Django与Apache2部署教程](https://docs.djangoproject.com/zh-hans/4.2/howto/deployment/wsgi/modwsgi/)
- [Vue PWA教程](https://pwa.vuejs.org/)
- [Web Bluetooth API文档](https://developer.mozilla.org/en-US/docs/Web/API/Web_Bluetooth_API)
- [ECharts文档](https://echarts.apache.org/zh/index.html)

